@* Toast Container - displays all active toasts *@
@implements IDisposable
@inject ToastService ToastService

<div class="fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm">
    @foreach (var toast in ToastService.Toasts)
    {
        <Toast Message="toast" OnDismiss="HandleDismiss" />
    }
</div>

@code {
    private System.Threading.Timer? _timer;

    protected override void OnInitialized()
    {
        ToastService.OnChange += HandleChange;

        // Periodic check to handle auto-removal (every 500ms)
        _timer = new System.Threading.Timer(_ =>
        {
            InvokeAsync(StateHasChanged);
        }, null, 500, 500);
    }

    private void HandleChange()
    {
        InvokeAsync(StateHasChanged);
    }

    private void HandleDismiss(Guid id)
    {
        ToastService.Remove(id);
    }

    public void Dispose()
    {
        ToastService.OnChange -= HandleChange;
        _timer?.Dispose();
    }
}
