@inherits LayoutComponentBase
@inject VFSStateService StateService
@implements IDisposable

<div class="h-screen flex flex-col bg-gray-50">
    @* Top Bar *@
    <TopBar OnToggleSidebar="ToggleSidebar" />

    @* Main Content Area *@
    <div class="flex-1 flex overflow-hidden">
        @* Left Sidebar (hidden on mobile by default) *@
        <div class="hidden lg:block">
            <LeftSidebar IsOpen="true" />
        </div>

        @* Main Content *@
        <main class="flex-1 overflow-auto">
            @Body
        </main>

        @* Right Preview Panel *@
        @if (StateService.ShowPreviewPanel)
        {
            <aside class="w-preview bg-white border-l border-gray-200 hidden lg:block overflow-y-auto">
                <FilePreviewPanel />
            </aside>
        }
    </div>

    @* Toast Notifications *@
    <ToastContainer />
</div>

@* Mobile Sidebar Overlay *@
@if (_sidebarOpen)
{
    <div class="fixed inset-0 z-40 lg:hidden">
        <div class="fixed inset-0 bg-black/50" @onclick="() => _sidebarOpen = false"></div>
        <div class="fixed inset-y-0 left-0 w-sidebar z-50 animate-slide-in">
            <LeftSidebar IsOpen="true" OnClose="() => _sidebarOpen = false" />
        </div>
    </div>
}

<div id="blazor-error-ui" data-nosnippet>
  An unhandled error has occurred.
  <a href="." class="reload">Reload</a>
  <span class="dismiss">X</span>
</div>

@code {
    private bool _sidebarOpen = false;

    protected override void OnInitialized()
    {
        StateService.OnStateChanged += StateHasChanged;
    }

    private void ToggleSidebar()
    {
        _sidebarOpen = !_sidebarOpen;
    }

    public void Dispose()
    {
        StateService.OnStateChanged -= StateHasChanged;
    }
}
