@inject NavigationManager Navigation
@rendermode InteractiveServer

<MudNavMenu Color="Color.Primary" Margin="Margin.Dense">
    <MudNavLink Icon="@Icons.Material.Filled.Dashboard" 
                Href="/" 
                Match="NavLinkMatch.All"
                Class="@GetNavLinkClass("/")">
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            <MudText>Dashboard</MudText>
            @if (IsCurrentPage("/"))
            {
                <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Text">
                    Active
                </MudChip>
            }
        </MudStack>
    </MudNavLink>
    
    <MudNavGroup Expanded>
        <TitleContent>
            <div style="display: flex; align-items: center">
                <MudIcon Icon="@Icons.Material.Filled.Folder" Class="mr-3"></MudIcon>
                File Operations
            </div>
        </TitleContent>
        <ChildContent>
            <MudNavLink Icon="@Icons.Material.Filled.CreateNewFolder" 
                        Href="/operations"
                        Class="@GetNavLinkClass("/operations")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>Create & Manage</MudText>
                    @if (IsCurrentPage("/operations"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
            <MudNavLink Icon="@Icons.Material.Filled.Search" 
                        Href="/search"
                        Class="@GetNavLinkClass("/search")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>Search Files</MudText>
                    @if (IsCurrentPage("/search"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
            <MudNavLink Icon="@Icons.Material.Filled.Edit" 
                        Href="/editor"
                        Class="@GetNavLinkClass("/editor")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>File Editor</MudText>
                    @if (IsCurrentPage("/editor"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
        </ChildContent>
    </MudNavGroup>
    
    <MudNavGroup Expanded>
        <TitleContent>
            <div style="display: flex; align-items: center">
                <MudIcon Icon="@Icons.Material.Filled.Settings" Class="mr-3"></MudIcon>
                System
            </div>
        </TitleContent>
        <ChildContent>
            <MudNavLink Icon="@Icons.Material.Filled.History" 
                        Href="/history"
                        Class="@GetNavLinkClass("/history")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>Change History</MudText>
                    @if (IsCurrentPage("/history"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
            <MudNavLink Icon="@Icons.Material.Filled.Event" 
                        Href="/events"
                        Class="@GetNavLinkClass("/events")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>Event Log</MudText>
                    @if (IsCurrentPage("/events"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
            <MudNavLink Icon="@Icons.Material.Filled.Analytics" 
                        Href="/analytics"
                        Class="@GetNavLinkClass("/analytics")">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText>Analytics</MudText>
                    @if (IsCurrentPage("/analytics"))
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Success" />
                    }
                </MudStack>
            </MudNavLink>
        </ChildContent>
    </MudNavGroup>
    
    <MudDivider Class="my-2" />
    
    <MudNavLink Icon="@Icons.Material.Filled.Code" 
                Href="https://github.com/Atypical-Consulting/VirtualFileSystem" 
                Target="_blank">
        Source Code
    </MudNavLink>
    
    <MudNavLink Icon="@Icons.Material.Filled.Description" 
                Href="https://github.com/Atypical-Consulting/VirtualFileSystem/blob/main/docs/README.md" 
                Target="_blank">
        Documentation
    </MudNavLink>
</MudNavMenu>

@code {
    private bool IsCurrentPage(string href)
    {
        var currentUri = Navigation.ToBaseRelativePath(Navigation.Uri);
        if (href == "/")
        {
            return string.IsNullOrEmpty(currentUri) || currentUri == "/";
        }
        return currentUri.StartsWith(href.TrimStart('/'), StringComparison.OrdinalIgnoreCase);
    }

    private string GetNavLinkClass(string href)
    {
        return IsCurrentPage(href) ? "mud-nav-link-active" : "";
    }
}